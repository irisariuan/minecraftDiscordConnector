generator client {
    provider = "prisma-client"
    output   = "../generated/prisma"
}

datasource db {
    provider = "postgresql"
}

model User {
    id           String        @id
    credits      Int           @default(0)
    permission   Int           @default(0)
    transactions Transaction[]
    permissions  Permission[]
    tickets      Ticket[]
}

model Transaction {
    id           String   @id @default(uuid())
    amount       Int
    beforeAmount Int
    afterAmount  Int
    reason       String?
    timestamp    DateTime @default(now())
    userId       String
    serverId     Int?
    server       Server?  @relation(fields: [serverId], references: [id])
    user         User     @relation(fields: [userId], references: [id])

    @@index([userId])
}

model Permission {
    userId     String  @id
    user       User    @relation(fields: [userId], references: [id])
    serverId   Int
    server     Server  @relation(fields: [serverId], references: [id])
    permission Int
    force      Boolean @default(false)

    @@index([userId])
}

model Server {
    id           Int           @id @default(autoincrement())
    port         Int[]         @default([25565])
    path         String        @unique
    pluginPath   String        @unique
    apiPort      Int?
    loaderType   String
    modType      String
    version      String
    tag          String?
    transactions Transaction[]
    permissions  Permission[]
    plugins      Plugin[]
    settings     Setting[]
}

model Setting {
    serverId Int
    server   Server @relation(fields: [serverId], references: [id])
    type     String
    name     String
    value    Int

    @@id([serverId, name, type])
}

model Plugin {
    id Int @unique @default(autoincrement())

    projectId String
    versionId String

    serverId Int
    server   Server @relation(fields: [serverId], references: [id])

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    filePath  String

    @@id([projectId, versionId, serverId])
}

model Ticket {
    id        String          @id @default(uuid())
    userId    String
    user      User            @relation(fields: [userId], references: [id])
    available Boolean         @default(true)
    history   TicketHistory[]
    reason    String?
    createdAt DateTime        @default(now())
    updatedAt DateTime        @updatedAt
    expiresAt DateTime?

    @@index([userId])
}

model TicketHistory {
    id        String   @id @default(uuid())
    ticketId  String
    ticket    Ticket   @relation(fields: [ticketId], references: [id])
    action    String
    reason    String?
    timestamp DateTime @default(now())

    @@index([ticketId])
}
